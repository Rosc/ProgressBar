<html>
	<script>

		//*********************************
		//	Progressbar v1(RC)
		//
		//	This is a one-file solution for making a regularly updating progress bar whose value
		//	is generated by comparing an internal variable against the contents of an external
		//	text file.
		//
		//	The external text file should contain only a single line with the number to be
		//	evaluated, but there it from halting permanently on bad data.
		//
		//*********************************
		//
		//	USER CONFIGURATION OPTIONS BELOW
		//
		//*********************************

		// Color for the page background.
		var BodyBackground = "#999999";

		// The overall height of the progress bar, in pixels
		var BarHeight = 50;

		// Corner radius for the bar, in pixels. Higher is rounder, lower is squared
		var BarRadius = 25;

		// Enables the bead at the beginning of the bar.  Set to false to hide it.
		var BeadVisible = true;

		// Set the length of the bead, in pixels.  Setting it as BarHeight will square it with the bar's height.
		var BeadWidth = BarHeight;

		// If you have a maximum value you expect to use regularly, you can set it here.
		// Regardless of what you set here, you'll be able to change it at run time.
		var ValueMax = 100;

		// Enable demo mode while waiting for maximum value and file location. false to disable.
		// This is mostly used for color transition testing.
		var DemoEnable = true;

		//  Set the refresh rate in milliseconds.
		var BarRefresh = 1000;


		//*********************************
		//	COLOR CONFIGURATION
		//
		//	Colors are defined in a matrix, allowing for almost unlimited granularity.
		//	The format for each line is as follows:
		//
		//	[Percentage Color Takes effect,'#Color Hex Code'],
		//
		//	* Lines should be in order by percentage, and there is no minimum or maximum of allowed lines
		//
		//	* For a static color, use only a single line with a percentage of 0
		//	
		//	* A smooth gradient from 0 to 100 must be set up manually with multiple intermediate
		//	  steps. 0 & 100 won't cut it.
		//
		//	* These matrices can all use different percentage increments to suit your needs.
		//	  They don't have to be in syncronized!  Be aware that Demo Mode's increments
		//	  are defined by the number of steps in BarProgress, so it may not show all
		//	  transitions if the other fields are incremented differently.  Despite that,
		//	  such transitions *will* work when the bar is actively running.
		//
		//*********************************

		//  This is the color table for the background bar. Default setting demonstrates wildly changing color.
		var BarBackground = [
			[0,'#FFFFFF'],
			[20,'#FF0000'],
			[40,'#FF00FF'],
			[60,'#00FF00'],
			[80,'#0000FF'],
			[100,'#000000'],
		];

		//  This is the color table for the progress portion of the bar. Default setting demonstrates a smooth gradient from dark to light.
		var BarProgress = [
			[0,'#0F7173'],
			[20,'#3A8A8C'],
			[40,'#66A4A5'],
			[60,'#91BEBF'],
			[80,'#BDD8D8'],
			[100,'#E9F2F2'],
		];

		//  This is the color table for the bead. Default setting demonstrates an unchanging black.
		var BeadColor = [
			[0,'#000000'],
		];

		//*********************************
		//
		//	UNDER NORMAL CIRCUMSTANCES, THERE SHOULD BE NO REASON TO EDIT BELOW THIS LINE
		//
		//*********************************

		function Setup() {
			document.body.style.background = BodyBackground;
			document.getElementById("TxtMax").value = ValueMax;

			document.getElementById("BarHundred").style.background = BarBackground;
			document.getElementById("BarHundred").style.height = BarHeight + "px";
			document.getElementById("BarHundred").style.borderRadius = BarRadius + "px";

			document.getElementById("BarValue").style.background = BarProgress[0][1];
			document.getElementById("BarValue").style.borderRadius = BarRadius + "px";

			document.getElementById("BarBead").style.background = BeadColor[0][1];
			document.getElementById("BarBead").style.borderRadius = BarRadius + "px";
			document.getElementById("BarBead").style.width = BeadWidth + "px";
			if (!BeadVisible) {
				document.getElementById("BarBead").style.visibility = "hidden";
			}
			if (DemoEnable) {
				document.getElementById("BarValue").style.width = "100%";
				DemoMode();
			}
		}

		function DemoMode() {
			if (typeof(BlobText) == "undefined") {
				var PctVal;
				for (var a = 0, len = BarProgress.length; a < len; a++) {
					if (document.getElementById("BarValue").style.width < (BarProgress[a][0] + "%") || (document.getElementById("BarValue").style.width.includes("px") && (BarProgress[a][0] / 100 * document.getElementById("BarHundred").clientWidth) > BeadWidth)) {
						document.getElementById("BarValue").style.width = BarProgress[a][0] + "%";
						PctVal = BarProgress[a][0];
						break;
					} else if (document.getElementById("BarValue").style.width == "100%") {
						document.getElementById("BarValue").style.width = BeadWidth + "px";
						PctVal = 0;
						break;
					} else if (a == len - 1) {
						document.getElementById("BarValue").style.width = "100%";
						PctVal = 100;
					}
				}
				if (BeadVisible) {
					document.getElementById("BarBead").style.background = ColorPicker(BeadColor, PctVal);
				}
				document.getElementById("BarValue").style.background = ColorPicker(BarProgress, PctVal);
				document.getElementById("BarHundred").style.background = ColorPicker(BarBackground, PctVal);
				window.setTimeout(DemoMode, 10000 / BarProgress.length);
			}
		}

		function Bootstrap() {
			if (!isNaN(parseFloat(document.getElementById("TxtMax").value))) {
				ValueMax = document.getElementById('TxtMax').value;
				BlobText = event.target;
				document.getElementById("WindowsSettings").style.visibility = "hidden";
				RefreshTimer();
			} else {
				document.getElementById("FileLocation").value = '';
			}
		}

		function RefreshTimer()
		{
			readTextFile();
			window.setTimeout(RefreshTimer, BarRefresh);
		}

		function ColorPicker(ColorTable, Percentage) {
			for (var a = 0, len = ColorTable.length; a < len; a++) {
				if (Percentage >= ColorTable[a][0]) {
						var ColorTemp = ColorTable[a][1];
				}
			}
			return ColorTemp;
		}

		function readTextFile(file)
		{
			var reader = new FileReader();
			reader.onload = function()
			{
				var text = reader.result;
				if(!isNaN(parseFloat(text))) {
					text = (text / ValueMax * 100);
					if (text > 100) { text = 100; }
					if (text < 0) { text = 0; }
					if (BeadVisible) {
						document.getElementById("BarBead").style.background = ColorPicker(BeadColor, text);
					}
					document.getElementById("BarValue").style.background = ColorPicker(BarProgress, text);
					document.getElementById("BarHundred").style.background = ColorPicker(BarBackground, text);
					if ((document.getElementById("BarHundred").clientWidth * text / 100) < BeadWidth) {
						document.getElementById("BarValue").style.width = BeadWidth + "px";
					} else {
						document.getElementById("BarValue").style.width = text + "%";
					}
				}
			}
			reader.readAsText(BlobText.files[0]);
		}
	</script>

	<style>
		#BarHundred {
			width: 90%;
			display: inline-block;
			margin: 50px;
		}

		#BarValue {
			width: 50%;
			height: 100%;
			display: inline-block;
			border-radius: 5px;
			-webkit-transition: 0.5s ease-in-out;
			-moz-transition: 0.5s ease-in-out;
			-o-transition: 0.5s ease-in-out;
			transition: 0.5s ease-in-out;
			-webkit-transition-property: width, background-color;
			-moz-transition-property: width, background-color;
			-o-transition-property: width, background-color;
			transition-property: width, background-color;
		}

		#BarBead {
			height: 100%;
			display: inline-block;
			margin: 0px;
			float: right;
			-webkit-transition: 0.5s ease-in-out;
			-moz-transition: 0.5s ease-in-out;
			-o-transition: 0.5s ease-in-out;
			transition: 0.5s ease-in-out;
			-webkit-transition-property: background-color;
			-moz-transition-property: background-color;
			-o-transition-property: background-color;
			transition-property: background-color;
		}
	</style>

	<body onload="Setup()">
		<div id="BarHundred">
			<div id="BarValue">
				<div id="BarBead"></div>
			</div>
		</div>
		<div id="WindowsSettings">
			100% Value: <input id="TxtMax" type="text">
			<input type="file" id="FileLocation" onchange="Bootstrap()">
		</div>
	</body>
<html>